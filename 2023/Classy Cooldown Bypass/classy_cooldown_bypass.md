# Classy Autograder Cooldown bypass

Aynakeya <aynakeya.official@gmail.com>


This bug was introduced in commit [bc11729](https://github.com/ubccpsc310/classy/commit/bc117293963719121e411d147b87f86388c02c22)

And fixed in commit [9070573](https://github.com/ubccpsc310/classy/commit/9070573c238945b2a933b73c4ea012498c35c2e4)

# Bug Description

We can use @310-bot #c0 #check to bypass cooldown.

Basically, there are two main reasons cause this bug.

Firstly, in `GithubAutoTest.handleCommentStudent`. The actually handler for #check hasn't been implement yet. So check command perform exactly same as a standard command. Since shouldCharge is set to false because of #check flag, the command is successfully proccessed.

```ts
const shouldCharge = await this.shouldCharge(target, null, res);
const feedbackDelay: string | null = await this.requestFeedbackDelay(target.delivId, target.personId, target.timestamp);
const previousRequest: IFeedbackGiven = await this.dataStore.getFeedbackGivenRecordForCommit(target);
```

```ts
        if (shouldCharge === true && previousRequest === null && feedbackDelay !== null) {
            Log.info("GitHubAutoTest::handleCommentStudent(..) - too early for: " + target.personId + "; must wait: " +
                feedbackDelay + "; SHA: " + Util.shaHuman(target.commitURL));
            // NOPE, not yet (this is the most common case; feedback requested without time constraints)
            const msg = "You must wait " + feedbackDelay + " before requesting feedback.";
            await this.postToGitHub(target, {url: target.postbackURL, message: msg});
        } else if (previousRequest !== null) {
            Log.info("GitHubAutoTest::handleCommentStudent(..) - feedback previously given for: " +
                target.personId + "; deliv: " + target.delivId + "; SHA: " + Util.shaHuman(target.commitURL));
            // feedback given before; same as next case but logging is different
            // processComment will take of whether this is already in progress, etc.
            await this.processComment(target, res);
            // } else if (target.flags.includes("#check")) {
            // NOTE: this was not the real code, I was trying to figure out where this should be
            //     Log.target("GitHubAutoTest::handleCommentStudent(..) - handling #check");
            //     await this.handleCheck(target, res);
        } else {
            Log.info("GitHubAutoTest::handleCommentStudent(..) - not too early; for: " +
                target.personId + "; SHA: " + Util.shaHuman(target.commitURL));
            // no time limitations. Because of this, queueing is the same as submitting now.
            // processComment will take of whether this is already in progress, etc.
            await this.processComment(target, res);
        }
```

Secondly, feedback is formated by `ClassPortal.formatFeedback`. However, formatFeedback only take one parameter which is `AutoTestResultTransport` (not related to comment itself). The result is fetched by `ClassPortal.getResult`, this function takes `deliverID`, `repoID` and `commitHash` (also not related to comment itself).

`ClassPortal` save result by `ClassPortal.sendResult`. This function are called once after GradingJob finished. After that, this result won't be changed.

Extra: giveFeedback in processExecution also doesn't really use kind...

So, if there is result already stored in database, and that result have kind=standard. Using  @310-bot #c0 #check will gives user a full grade feedback, instead of "AutoTest status for commit: **something**"

also, if the result stored in database has kind=check. @310-bot #c0 will also return "AutoTest status for commit: **something**" because of the same reason.

How to trigger this bug

1.  call @310-bot #c0
2.  wait until grading finish. usually under 30 min
3.  call again @310-bot #c0 just in case
4.  call @310-bot #c0 #check to trigger bug and get grade.
